# PDF Signer Examples

This directory contains example scripts and demo files for the PDF signer tool.

## Scripts

### 1. `mk-demo.sh` - Create Demo PDF and Signature Image

Creates both a sample 3-page PDF document and a professional signature image for testing PDF signing functionality.

**Usage:**

```bash
./mk-demo.sh
```

**Output:**

- `demo3page.pdf` - A 3-page sample contract document
- `signature-demo.png` - A professional signature image (500x200 pixels)

**PDF Pages:**

- Page 1: Title/Cover page with company information
- Page 2: Terms and conditions with formatted text and tables
- Page 3: Signature page with designated signing areas

**Signature Image Features:**

- Professional border styling with midnight blue accents
- "Digitally Signed" heading
- Signer name and date
- Decorative corner elements
- 500x200 pixels (optimal for PDF signatures)
- Cross-platform generation using Pillow (no external dependencies)

**Features:**

- Professional document layout
- Tables with financial information
- Proper spacing for signatures
- Ready-to-use signature graphic
- Fully cross-platform (macOS, Linux, Windows)
- No external tools required (pure Python)

---

### 2. `demo_sign.sh` - Quick Demo Signing Script

Automatically signs the `demo3page.pdf` with the `john_extended` certificate and `signature-demo.png` image.

**Usage:**

```bash
./demo_sign.sh
```

**What it does:**

1. Checks for `demo3page.pdf` (creates it if missing)
2. Checks for `signature-demo.png` (creates it if missing)
3. Verifies `john_extended` certificate exists
4. Signs the PDF with certificate and image
5. Places signature on page 3, bottom-right corner
6. Shows helpful next steps

**Features:**

- Fully automated - no user input required
- Handles empty certificate password automatically
- Creates missing files on-the-fly
- Provides clear success/error messages
- Shows file sizes and locations

**Output:**

- `demo3page-signed.pdf` - The signed PDF with visible signature

---

### 3. `sign-example.sh` - Advanced Signing Examples

Demonstrates various PDF signing scenarios using certificates from demo-cfssl.

**Usage:**

```bash
./sign-example.sh
```

**What it demonstrates:**

1. **Invisible Signature** - Signs without visual indicator
2. **Visible Signature (Text Only)** - Adds text-only signature box
3. **Visible Signature (With Image)** - Uses custom signature image
4. **Custom Position** - Places signature at specific coordinates
5. **Different Pages** - Signs on various pages

**Requirements:**

- demo-cfssl certificates (from `../../steps.sh`)
- `demo3page.pdf` and `signature-demo.png` (created by `mk-demo.sh`)

---

### 4. `complete-workflow.sh` - Complete Workflow Demo

A comprehensive demonstration of the entire PDF signing workflow.

**Usage:**

```bash
./complete-workflow.sh
```

**Workflow:**

1. ✅ Create a demo 3-page PDF
2. ✅ Generate a signature image
3. ✅ Sign the PDF with certificate
4. ✅ Verify the signature
5. ✅ Display summary and next steps

**Features:**

- Automatic certificate detection
- Color-coded output
- Error handling
- Step-by-step progress
- Helpful guidance if certificates are missing

---

## Generated Files

After running the scripts, you'll find:

| File                   | Description            | Generated By                         |
| ---------------------- | ---------------------- | ------------------------------------ |
| `demo3page.pdf`        | 3-page sample document | mk-demo.sh                           |
| `signature-demo.png`   | Professional signature | mk-demo.sh                           |
| `demo3page-signed.pdf` | Signed version         | demo_sign.sh or complete-workflow.sh |

## Quick Examples

### Fastest Way: Use `demo_sign.sh`

The quickest way to see PDF signing in action:

```bash
./demo_sign.sh
# on MacOS
open -a "Adobe Acrobat Reader" examples/demo3page-signed.pdf
```

This single script:

- Creates the demo PDF and signature image (if needed)
- Signs the PDF with the john_extended certificate
- Shows you the output file and next steps

### Create and Sign in One Go

```bash
# Create PDF and signature image
./mk-demo.sh

# Sign it with the generated signature image
cd ..
uv run python -m pdf_signer.sign sign \
    examples/demo3page.pdf \
    examples/demo3page-signed.pdf \
    --p12 ~/.config/demo-cfssl/smime-openssl/john_extended/email.p12 \
    --password-file /dev/null \
    --image examples/signature-demo.png \
    --position bottom-right \
    --page 3 \
    --reason "Test Signature"
```

The signature image is automatically created by `mk-demo.sh`, so you don't need ImageMagick or any external tools!

### Custom Signature Position

```bash
# Sign on page 1, top-right corner
uv run python -m pdf_signer.sign sign \
    examples/demo3page.pdf \
    output.pdf \
    --p12 certificate.p12 \
    --position top-right \
    --page 1 \
    --width 250 \
    --height 120
```

### With Timestamp

```bash
# Sign with timestamp from TSA server
uv run python -m pdf_signer.sign sign \
    examples/demo3page.pdf \
    output.pdf \
    --p12 certificate.p12 \
    --position bottom-right \
    --page 3 \
    --timestamp-url http://timestamp.digicert.com
```

## Integration with demo-cfssl

These examples work seamlessly with certificates from the demo-cfssl project:

```bash
# 1. Generate certificates (from demo-cfssl directory)
cd ../..
./steps.sh

# 2. Create demo PDF
cd pdf-signer/examples
./mk-demo.sh

# 3. Sign with your certificate
cd ..
uv run python -m pdf_signer.sign sign \
    examples/demo3page.pdf \
    examples/signed.pdf \
    --p12 ~/.config/demo-cfssl/smime-openssl/john_extended/email.p12 \
    --position bottom-right \
    --page 3

# 4. Open in Adobe Acrobat Reader

open -a "Adobe Acrobat Reader" examples/signed.pdf

# 5. Verify
uv run python -m pdf_signer.sign verify examples/signed.pdf --verbose
```

## Creating Your Own Test PDFs

The `mk-demo.sh` script uses Python's ReportLab library. You can modify it to create custom test documents:

```python
# Add more pages
elements.append(PageBreak())
elements.append(Paragraph("New Page Content", heading_style))

# Add images
from reportlab.platypus import Image
elements.append(Image('logo.png', width=2*inch, height=1*inch))

# Add more complex tables
data = [['Col1', 'Col2'], ['Data1', 'Data2']]
table = Table(data)
elements.append(table)
```

## Troubleshooting

### "No module named 'reportlab'"

The script uses `uv run` to ensure the right Python environment. If you still get this error:

```bash
cd ..
uv sync
cd examples
./mk-demo.sh
```

### "Certificate not found"

Make sure you have generated certificates:

```bash
cd ../..
./steps.sh
```

Or provide your own certificate with `--p12` option.

### "Failed to create signature image"

The signature image is created using Python's Pillow library, which is already included in the project dependencies. If you get this error:

1. Make sure you've run `uv sync` to install all dependencies
2. Check that Pillow is installed: `uv run python -c "import PIL; print(PIL.__version__)"`
3. Try running the script again

The signature generation is purely Python-based and doesn't require any external tools like ImageMagick.

## Clean Up

Remove all generated demo files:

```bash
# From the examples directory
rm demo3page*.pdf signature-demo.png

# Or remove everything at once
rm -f demo3page.pdf demo3page-signed.pdf signature-demo.png
```

## Next Steps

1. Try modifying the demo PDF content in `mk-demo.sh`
2. Create your own signature images
3. Experiment with different signature positions
4. Add timestamps to signatures
5. Test verification in different PDF viewers

## See Also

- [../README.md](../README.md) - Main documentation
- [../QUICKSTART.md](../QUICKSTART.md) - Quick start guide
- [../../CRL_MANAGEMENT.md](../../CRL_MANAGEMENT.md) - Certificate revocation
- [../../README.md](../../README.md) - demo-cfssl documentation
